<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/polymer/lib/elements/dom-repeat.html">

<link rel="import" href="bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="bower_components/polymerfire/firebase-query.html">

<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">


<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">

<dom-module id="twic-users">
  <template>

    <style>
    :host{
      display: block;
      padding: 10px;
    }
    #create { width: 100% }
    #twic-users-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #twic-users-list li {
      @apply(--layout-horizontal);
      @apply(--layout-center;)
    }
    #twic-users-list .content {
      @apply(--layout-flex);
      padding: 8px;
    }
    #twic-users-controls {
      @apply(--layout-horizontal)
      @apply(--layout-center-justified)
    } 
    </style>

    <firebase-auth user="{{user}}"></firebase-auth>
    <firebase-query 
      id="query"
      path="/users/[[user.uid]]/users"
      data="{{users}}"
    >
    <div id="card">
      <div id="users">
        <ul id="user-list">
          <template is="dom-repeat" items="[[users]]" as="user">
            <li>
              <p class="content">
                [[user.content]]
              </p>
              <paper-icon-button icon="clear" user="[[user]]" on-tap="remove"></paper-icon-button>
            </li>
          </template>
        </ul>

        <paper-input id="input" always-float-label error-message="Bad user name" label="Add a new user..." on-keypress="enterKeyPressed"></paper-input>
        <div id="users-controls">
          <paper-button id="add" on-tap="add">Add</paper-button>
        </div>
        <!-- <template is="dom-bind"> -->
        <!-- <form> -->
          <twic-new-user></twic-new-user>
          <!-- <twic-new-user new_user="{{_data}}"></twic-new-user>
          <input type="submit" name="twic-new-user" class="btn">
          <input name="new_user" value="[[_data]]" hidden> -->
        <!-- </form> -->
        <!-- <paper-button id="test" on-tap="test" raised>Test Form</paper-button> -->
        <!-- </template> -->

      </div>
    </div>
    </firebase-query>
  </template>

  <script>
    class TwicUser extends Polymer.Element {
      static get is() { return 'twic-users'; }
      static get properties(){
        return {
          users: {
            type: Object
          }
        }
      }

      test(){
        value = this.$.new_user.value;
        if(value!=null){
          console.log('failure');  
        } else {
          console.log('success');
        }
        
      }

      add(){
        // add item in input text box to database
        this.$.query.ref.push({
          content: this.$.input.value
        })

        // clear text field
        this.$.input.value = null;
      }
      
      enterKeyPressed(e){
        if(e.which === 13 || e.keyCode === 13){
          console.log(e)
          this.add()
        }
      }

      /**
       * Go to database find item that matches the key and delete it
       */
      remove(e){
        let key = e.currentTarget.user.$key;
        this.$.query.ref.child(key).remove()
      }
    }
    customElements.define(TwicUser.is, TwicUser);
  </script>
</dom-module>